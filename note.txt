设计笔记
这是用户的开发笔记，AI请忽略本文件的内容！

# 项目总述
基于游戏《明日方舟》集成战略玩法“探索者的银淞止境”中“密文板”的设定，创作的神秘学占卜网站应用。用户抽取两块密文板，获得一些信息，然后由占卜师解读和解答用户的提问。
重点有两部分，一是密文板相关文案和设定提供的神秘感，二是由大语言模型AI驱动的占卜师对话，提供具有互动性的占卜结果解读和咨询对话。
因此符合北方冰原古老神秘的界面和互动设计很重要。设计要非常精美又富有神秘感才行。不知道怎么跟你解释，参考明日方舟UI风格，或者苹果公司的现代化风格。

# 世界观设定

## 引言
远山的密文板占卜小屋
探索者和女祭司
来自萨米的埃拉菲亚女祭司“远山”，带来北方冰原的神秘箴言，帮助您探索命运的低语。选择两块密文板，回答她的提问，然后倾听萨米的教诲。

## 大致流程

首先，输入您的称呼：

选择布局：选择一块布局密文板
选择本因：选择一块本因密文板
开始宣告：揭示密文板内容
无法匹配：选择的两块密文板无法合法组合，请重新选择。此时只显示密文板图标和名称，不显示详细信息
组合规则：世相只能和世相组合，其他可自由两两组合。同类组合时触发一条协语。（双世相时，触发特殊协语“星门”，页面发生特殊变化，自动揭示，不可解读，不可修改）
宣告：显示密文板图标，名称，说明，主神，箴言
命运馈赠：探索者获得本次宣告的密文板价值1/4的原石锭
逆天改命：消耗原石锭回购一块或两块已抽取的密文板，并重新抽取。被回购的密文板不会出现在本次抽取中。
追问：由祭司追求一个问题，探索者必须如实回答
释文：祭司解读密文板，并向探索者提出建议，可以进行几轮对话。

## 密文板的设定
图像，名称，神名，神谕
其中神名有音译，直译，原文三种形式（实际上意译就是名称）
每张密文板有一个类型（族群，灵魂，自然，世相，视相）
密文板本身分为两类，布局（艾塔布局）和本因（法玛谋篇）
密文板有价值，其值可能为8、12、16原石锭
世相类密文板没有价值，不可回购，不提供馈赠
本因密文板在与同类型布局密文板一同宣告时会触发协语（两个族群，或者两个灵魂，或者两个自然）
视相密文板只有两个，都是布局型，与任意本因组合时必然触发协语。世相密文板只有两个，分别为布局型和本因型，且只能与对方组合，没有协语。
密文板一般上下组合，上为布局，下为本因。
选择密文板时，有概率触发修辞。
修辞是随机附加在密文板上的额外特性，但伤痕和空无（世相类）密文板无法附加修辞。修辞有四种：
    1. 延续：仅可能附加于布局。对布局造成“重复”的作用。
    2. 自足：仅可能附加于本因。若触发协语，则对协语造成“强化”的作用。
    3. 循环：仅可能附加于本因。若触发协语，则对协语造成“自指”的作用。
    4. 广阔：仅可能附加于布局。对布局造成“扩散”的作用。


## 术语英文翻译表
巴斯克 Euskal
密文板 Foldartal
布局 Layout 
本因 Source 
族群 Clan
自然 Nature
灵魂 Soul 
视相 Vision
世相 Society
宣告 Declaration 
协语 Concord 
修辞 Flair


# 界面和功能设计
那么显然可以使用React技术栈，Redux不知道用不用得上，用一些localStorage，tailwind也是不可少的。后期也需要做响应式布局（只适配PC和一个尺寸的移动端）。
暂时不考虑夜间模式，因为主题艺术风格的原因，整体配色估计就是个深色的。
AI服务模块：负责连接AI服务端，整理用户提示词，整理AI服务商配置，整理参数配置，整理系统提示，整理请求头，接收流式回复，中断请求。密钥、baseurl以环境变量的形式提供。
对话模块：提供主界面上女祭司与用户对话的模块。包括女祭司形象（就是个立绘图片），对话框（一个具有装饰的对话框，参考视觉小说那样的），相关功能按钮（发送消息，终止回复，重新回复）。视觉上就是左边一个半身立绘，居中下半部分是对话框/输入框，消息可以上下滚动以回顾历史消息。
密文板选择界面：列出所有密文板（背面），由用户随机选择两个，显示在屏幕中央。允许放回重选。选完确认宣告。（其实根本不用真放上每个板子，因为后面宣告时才随机选取两个板子。反正都是随机的。）
密文板宣告界面：宣告被选择的两个板子（随机选择两个板子展示出来），按规则展示结果，包括密文板信息，修辞情况，协语情况。这是最重要的界面元素，合理设计密文板布局、排版与动效是本项目艺术效果的核心。
菜单按钮：功能性元素集中放到菜单里去。点击菜单按钮后弹出一个大的模态框，顶部一行菜单标签，下面是内容。菜单主要有几项：暂时就做一个“关于”吧，其他的一下子想不起来。

美术资产放在./asset/下，包括所有密文板和修辞的logo，远山的几张立绘，远山的一个物品图片。
项目目录下还有密文板资料和远山的个人资料。

原石锭和回购系统比较进阶了，第一版不做这个功能，留到2.x版再做吧。
同样的还有“双世相”特殊效果，也留到2.x版。
放回重选功能也暂时不做。
优先实现核心功能，先有骨架再丰富。


12月29日
记录一下打算未来逐步实现的计划
todo：更好的视觉动效：使用渐变滑入处理元素的出场入场
todo：微调密文板和卡牌的显示效果，以及相关文字效果
todo：为多种元素增加透明玻璃感的背景（其实就是半透明深色背景）
todo：调整提示词工程，增加沉浸感
todo：调整远山立绘显示（增加点击立绘变更下一张）
todo：配色和细节美术优化
todo：占卜历史查看列表（保留最近10条）
todo：导出占卜结果。可以尝试使用EdgeOne的html图片渲染云函数
todo：回购系统：也许应该直接要求回购两张密文板，然后才能重新抽卡。采用放回重抽模式比较简单好实现。
todo：明牌模式，方便用户检视所有密文板


# 配色系统
荧光绿 #bcedf5 用于神奇，神秘，异能，神谕等相关概念
冰雪白 #CDCFD5 用于萨米的自然，环境，通用背景
深空蓝 #233340 用于萨米的深空，宏达，深邃，寒冷，通用背景
族群红 #b83f38 族群类，下同
自然绿 #34847c 
灵魂蓝 #3473ab
世相灰 #6e6d6e
世相彩 background:conic-gradient(#c14141, #2a5778, #1e9782, #c14141); 用于世相相关的特种配色
背景灰 #464646 用于局部通用背景，密文板等logo图像展示背景
远山红 #902D46 “远山”的角色色之一，下同
远山黑 #36262E
远山粉 #EDDCD4
灰雪白 #9ebbd7 用于密文板相关的的一般性文字，或Rune型文字，有雕刻感


一般强调：正面属性的强调的文字
color: #e1f5fe;
text-shadow: 0 0 3px #03a9f4, 0 0 5px black, 0 0 5px black;

荧光强调：
适用于强调。荧光绿文字可加背景#5fb4cf 或 linear-gradient(45deg, #121c24, #5fb4cf)

标志卡片：
加底的小logo（适用于标志用的少量文字，例如“修辞”，“协语”字样）
background: linear-gradient(90deg, #4a7aad, #91dded);
color: white;
padding: 0px 5px;
border-radius: 2px;


12月29日
对话区域大改：消息显示区域中可上下滚动显示文本。远山的立绘作为消息区域边框装饰的一部分，不随文本滚动，固定在左下角位置，挡住边框的左下角。输入框在消息区域的下方，一个单独的具有边框的矩形，现在这样就不错，高度增加到4rem差不多。消息内容简化：一行单列发言人名字，其后多行显示消息内容即可，不用对话气泡模式。另外注意立绘是png资源，其边界部分大多是透明的，因此尺寸做大一些，否则看起来就太小了。
人物立绘，png格式的，因为是人物嘛，所以矩形图片中除人体外的边边角角就是透明的。我现在想将它在页面上显示为人物下30%部分亮度渐变，上70%正常，但是我看到这导致下方透明部分也黑了一些。能不能利用mask避免这渐变对透明背景的影响。
很好。现在调整一下对话页面的布局。左边是人物立绘，高度与文字显示区域一样高，与文字显示区域并排布局，右边是文字显示区域，可上下滑动，下方是输入框。文字显示区域的每条消息不做边框，背景做半透明。
立绘看起来还是太小了。调整一下：
对话区域：
    上方大部分：
        左侧30%立绘区域，右侧80%消息区域 （重叠10%，消息在上，消息的背景半透明）
    下方：输入框


选择密文板界面大改。
改为使用两个占位符放在屏幕上，用户分别点击占位符，则选定一个布局或本因（用发光、微小上移提指示已选定）。点击下方的开始宣读按钮，以进入下一步揭示密文板。
揭示密文板后，在占位符处分别显示本次获得的两块密文板，在中间展示本次触发的协语和修辞。密文板下方展示密文板名字，唱词。再下方展示主神的箴言。
注意整体视觉设计的协调、美感。


整个项目不需要额外的边框和容器元素，我希望整个页面的体验是无边界的。想想苹果的顶尖前端设计师会怎么做网页。


选择密文板界面：点击“布局”后通过视觉呈现为已选中状态，实际上后台随机选择一个布局密文板，这时先不显示，等待两个密文板都选好了后，点击宣告后，再显示详细信息！！换句话说用户全程都不会看到“全部密文板列表”之类的东西！

增加了一条配色：灰雪白 #9ebbd7 用于密文板相关的的一般性文字，或Rune型文字，有雕刻感。
我看到你的修改，现在整个页面的上下两部分看起来比较割裂，我希望能自然一点，视觉上形成一体。
上半部分（密文板选择和展示部分）稍微做小一点，给下半部分留出空间。板子本身仍左右布置，修辞在板子的右上角显示，协语在中间显示，再居中下方显示唱词，重新选择按钮在本区域的中间最下方。神谕显示在外侧（左边板子的左边，右边板子的右边）。
下半部分把元素背景色尽量都取消了，与上半部分和谐匹配。输入框改短一点，与消息区域一样宽，也就是说左边不侵入立绘区域。元素逻辑变成：左边是立绘，右边是消息区域和底部输入框。
整个页面的背景图片固定于视图之中，不随页面滚动而移动。


增加密文板位置美术设计：
密文板位置增加一个背景素材“卡片背景504x792.jpg”（在public/asset里），让密文板图标、名称都显示在这个卡片之上。
卡片在一开始就存在，上显示占位符，并遮盖一个仅有0.3亮度的蒙版，以示尚未揭示之意。
点击选择后，增加一个微弱的周围发光效果，以提示已经选定。注意与配色设计方案和谐。
宣告后，选取的密文板显现在卡片上，同时取消掉暗色蒙版，以体现“浮现”，“揭示”的概念。可通过css动画实现。
另外在密文板选择页面的左边和右边分别贴上背景图案“布局密文板的背景图形.png”和“本因密文板的背景图形.png”。这是两个简单的图腾图形，作为背景装饰用。可以显示得大一些。

两个背景图腾图形的width改为50%，height改为100%。


对宣告的结果的管理：在点击宣告的瞬间，确定各随机结果，包括：布局密文板名，修辞名，本因密文板名，修辞名，将结果与当时的时间组合成一个json object，追加到localStorage中的一个列表里去。UI均以该确定性结果为依据进行显示。

我想预制几种特定的css动画/样式，以备使用。
1. “浮现”，从opacity-0 translate-y-[5px] transition-all duration-300 变成 opacity-100 translate-y-0  
2. “消隐”，从opacity-100 translate-y-0 transition-all duration-300 变成 opacity-0 translate-y-[-5px]  
3. 淡入：从opacity-0 transition-all duration-1000 变成 opacity-100  
4. 淡出：从opacity-100 transition-all duration-1000 变成 opacity-0  
还有一些样式：
5.一般强调：正面属性的强调的文字
color: #e1f5fe;
text-shadow: 0 0 3px #03a9f4, 0 0 5px black, 0 0 5px black;
6.荧光强调：
适用于强调。荧光绿文字可加背景#5fb4cf 或 linear-gradient(45deg, #121c24, #5fb4cf)
7.标志卡片：
加底的小logo（适用于标志用的少量文字，例如“修辞”，“协语”字样）
background: linear-gradient(90deg, #4a7aad, #91dded);
color: white;
padding: 0px 5px;
border-radius: 2px;


参考以下代码，修改冰玻璃效果：
/* 立体感更强 */
.ice-glass {
    background: linear-gradient(
        135deg, 
        rgba(255, 255, 255, 0.1) 0%, 
        #cdcfd533 100%   //这里引用冰雪白
    );
    backdrop-filter: blur(10px);
    border-radius: 0.5rem;
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.1),     /* 主阴影 */
        0 2px 8px rgba(0, 0, 0, 0.08),     /* 次阴影 */
        // inset 0 1px 1px rgba(255, 255, 255, 0.4), /* 顶部内高光 */
        // inset 0 -1px 1px rgba(0, 0, 0, 0.05);   /* 底部内阴影 */
    border: 1px solid rgba(255, 255, 255, 0.18);
    position: relative;
    overflow: hidden;
}



让重新整理一下整个页面的结构：
首先我希望页面是充满视窗的，除非视窗高度小于某特定高度，否则整个页面不会需要上下滚动，一屏即可显示完。
整体上的相对位置关系：页面上方40%是密文板等信息；下方左边40%是人物立绘，右边60%是对话区域。
整体层级关系
    背景图片置于最底层（不妨记为0），铺满视窗
    两个图腾置于1层
    密文板相关的卡片、文本、按钮等相关内容在2层，人物立绘、消息展示区域、对话框也在此层。注意密文板和卡片显然是有遮盖关系的，严格来说密文板logo会在卡片的上层，但是我们这里说的层是整体意义上的层级关系，不拘小节。
页面上的元素，从上到下分别是引导文本、密文板展示区域、对话区域。
密文板展示区域：
    左右对称布局。有两种状态：选择密文板，揭示密文板
    选择密文板状态：左右各一张卡牌，暗色样式，等待点击选择。中间显示一个“开始宣告”文字按钮，并添加背景图片（资料背景素材小图腾1x1.png）
    揭示密文板状态：
        两张卡片上显示各自的密文板内容。
        中间区域：
            首先是显示可能存在的修辞。
            如果触发协语，则显示协语的类型（显示为“协语·{类型名}”，并在文字下衬对应的素材图（族群logo1x1.png，自然logo1x1.png，或灵魂logo1x1.png））
            之后显示两块板的唱词
        外侧区域：卡片的外侧分别显示两个板子的箴言内容。
密文板展示区域和对话区域之间用一个元素分开，居中用素材：素材横向装饰冰凌深色662x185.png
对话区域：
    包括消息显示区域和消息输入区域

我希望每个功能区域的元素的class里都写上它的名字。页面整体元素的树状结构清晰。没有过多的包装元素/容器元素。


立绘的justify改为end
对话区加20%的margin-right，宽度改为50%
两个背景图腾放到0层去，固定大小和位置。（图腾宽度25%视窗，两个图腾中心分别在视窗宽度的25%和75%位置，上top-0）
“开始宣告”文字按钮放在两张卡片中间的区域，并添加背景图片（素材用：资料背景素材小图腾1x1.png）


卡片这个素材比较复杂。它上面画了一些位置用来放对应的图标或文案的。所以我想将这个卡片和其上元素的显示（背面，正面两种状态）封装为一个单独的组件。最后其他组件直接使用这个卡片组件，则可保证卡片组件内元素的相对位置均正确显示。
一个背面卡片应该：
    有以下状态：待选择（暗色），已选择（发光），再次点击可恢复待选择状态。
    有以下参数：本因还是布局？已选择还是未选择？
    有以下元素：“本因”（或“布局”）字样，相对位置需手动微调。已选择/点击选择字样，同样位置需要再反复微调匹配。
一个正面卡片应该：
    有以下参数：密文板名
    有以下元素：主神名，密文板图标，密文板类型，密文板名。同样的这四个元素的位置都需要手动微调才行。



2025年12月31日01:31:57 TODO：
? handleSendMultipleMessages有啥场景会被用？
◇ 对话系统包括占位符功能，都需要重新检查
◇ 协语由视相触发时logo引用有问题


我没看懂handleSendMultipleMessages和handleSendMessage有啥必要分为两个函数。aiService就是个纯函数，调用者每次组织好messages的内容（无非就是若干system/assistant/user的消息list），发送过去就行了。分这两个函数，说明更上级的调用者（Dialog）的逻辑写得不合理。
我们来重写梳理一下对话的逻辑。
首先ai对话的原理，正如上述所说，每次发送的都是所有的messages，根本就不存在一条消息或多条消息的概念，每次请求都会需要发送全量消息的。
在功能上，首先，当宣告完成后，由密文板工作模块给对话模块发送一个信号，告诉它宣告已完成。
对话模块收到宣告已完成信号后，清空消息显示区的内容（正常来说这里也没有内容），然后把一个系统提示发给AI，并等待AI回复。
系统提示由src\components\Dialog\SystemPrompt.tsx提供。
后续则是用户输入、对话模块发送和接受消息，如此往复。
关于消息显示区域的视觉效果，首先当发出了AIService.chat请求后，在等待首字回复期间，显示占位符和加载动画“嗯...”。当获取到首字回复后，清除加载动画内容，在对话框中开始流式显示回复内容，直到回复完成。


现在消息显示区域的显示逻辑是怎么样的，数据源是localMessages吗？
我需要给每条消息都增加一个标记，说明这条消息是否应该被显示在消息显示区域中。因为我考虑可能需要通过程序自动发送一些"user"消息，所以，可能有些消息确实需要发给ai但是又不适合展示给用户。



对话这一部分，我有一些设计，请你帮我实现。
从成功宣告后开始：向AI发送一个系统提示（包括场景说明，角色设定，抽取的两个密文板的信息），以及一条user消息（要求AI返回一条指定格式的询问），这两条信息都不显示在消息区域。接下来AI会回复一条信息，这里正常显示到消息区域，后续用户正常与ai对话，都正常显示到消息区。
这么设计的出发点是，希望在用户看来，对话是由AI发起的，这样用户比较进入对话。










































参考资料
【萨米神话学·上】萨米信仰辞典&密文神名全解（1/3） - 明日方舟 - 森空岛 - 2025/12/27: https://www.skland.com/article?id=111852
【萨米神话学·上】萨米信仰辞典&密文神名全解：集成战略“探索者的银凇止境”&SideStory“眠于树影之中” - 知乎 - 2025/12/27: https://zhuanlan.zhihu.com/p/643279675

【舟英语小课堂】萨米密文板的诗句是如何翻译的？欣赏外服翻译_游戏热门视频 - 2025/12/27: https://www.bilibili.com/video/BV1mJyQBiEdK/?vd_source=083a6d2beabdc6e71c7e5bcf87e59d68

【明日方舟】萨米肉鸽全密文板研究，感觉自己在考古_游戏热门视频 - 2025/12/27: https://www.bilibili.com/video/BV1Bu41157du/?spm_id_from=333.788.recommend_more_video.0&trackid=web_related_0.router-related-2206419-t84qs.1766808494112.609&vd_source=083a6d2beabdc6e71c7e5bcf87e59d68

探索者的银凇止境/密文板研究 - PRTS - 玩家共同构筑的明日方舟中文Wiki - 2025/12/27: https://prts.wiki/w/%E6%8E%A2%E7%B4%A2%E8%80%85%E7%9A%84%E9%93%B6%E5%87%87%E6%AD%A2%E5%A2%83/%E5%AF%86%E6%96%87%E6%9D%BF%E7%A0%94%E7%A9%B6

Expeditioner's Joklumarkar: Foldartals - Arknights Terra Wiki - 2025/12/28: https://arknights.wiki.gg/wiki/Expeditioner%27s_Joklumarkar/Foldartals

古弗萨克文（卢恩文）的资料
Elder Futhark - Wikipedia - 2025/12/28: https://en.wikipedia.org/wiki/Elder_Futhark

萨米文的字体资料（极北卢恩文）这是明日方舟中萨米相关字体的标准物料。
微件:FarNorthRunesFonts - PRTS - 玩家共同构筑的明日方舟中文Wiki - 2025/12/28: https://prts.wiki/w/%E5%BE%AE%E4%BB%B6:FarNorthRunesFonts

另参考：泰拉文字 - PRTS - 玩家共同构筑的明日方舟中文Wiki - 2025/12/28: https://m.prts.wiki/w/%E6%B3%B0%E6%8B%89%E6%96%87%E5%AD%97#%E8%90%A8%E7%B1%B3%E6%96%87%E5%AD%97%EF%BC%88%E8%8A%99%E5%B0%94%E5%A6%B2%E5%AF%86%E6%96%87%EF%BC%89
重点摘录如下：
萨米文字（芙尔妲密文）
此文字首次用于故事集《眠于树影之中》的外文标题（刻写体），后用于集成战略《探索者的银凇止境》主题绝大多数UI和宣发资源（标准印刷体）。
字体参数与用法
设计源：卢恩文字。
字符映射：各字母可与英文拉丁字母一一对应；拉丁字母部分不区分大小写。
语言系统：同古诺斯语、冰岛语和英文，即按照此三种语言的常规方式组词表意。
若语言中存在非英文拉丁字母，则替换为相近的字母。
例：古诺斯语“Skógrinn”（森林，单数有定主格），字母“ó”替换为相近的“o”，写作“Skogrinn”（Skogrinn）。
阅读与书写：按照适用语言的阅读顺序书写。
世界观信息
萨米语分为两种模式：“模式A”与“模式B”，其中：
模式A与乌萨斯语接近，但文字等已失传，无法确认。
模式B相对孤立，但与维多利亚语有部分相似之处。
按照“安玛塔卢”的传说，此为萨卡兹独眼巨人来到萨米后传授的语言文字。
该模式的文字系统称为“芙尔妲塔尔”，即“芙尔妲密文”，特点是棱角分明的形状与部分弧形/水平的笔画。
前者表明此文字是一种刻写文字，后者则推测可能是此类文字最初刻写在质地较脆的低密度源石晶体上。

这里指明萨米文字的26个字母的编码为从\u41到\u5a，也就是A-Z的ascii码，用了字形映射复用。因此关键在如何正确引入FarNorthRunesFonts。链接中给出了示例：
<style>
    @font-face {
       font-family: "FarNorthRunes-Regular";
       font-style: normal;
       font-weight: 400;
       src: url(https://static.prts.wiki/assets/fonts/FarNorthRunes-Regular.ttf);
       src: url(https://static.prts.wiki/assets/fonts/FarNorthRunes-Regular.eot?#iefix) format("embedded-opentype"),url(https://static.prts.wiki/assets/fonts/FarNorthRunes-Regular.woff) format("woff"),url(https://static.prts.wiki/assets/fonts/FarNorthRunes-Regular.ttf) format("truetype")
   }
   @font-face {
       font-family: "FarNorthRunes-Heavy";
       font-style: normal;
       font-weight: 400;
       src: url(https://static.prts.wiki/assets/fonts/FarNorthRunes-Heavy.ttf);
       src: url(https://static.prts.wiki/assets/fonts/FarNorthRunes-Heavy.eot?#iefix) format("embedded-opentype"),url(https://static.prts.wiki/assets/fonts/FarNorthRunes-Heavy.woff) format("woff"),url(https://static.prts.wiki/assets/fonts/FarNorthRunes-Heavy.ttf) format("truetype")
   }
</style>

游戏中进行密文板宣告的UI可供参考
【大地捕猎，英雄告解！】 https://www.bilibili.com/video/BV1e84y1X7re/?share_source=copy_web&vd_source=0c37ba8ad0c69f7dfc431961115a5a31